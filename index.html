<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>WSS Data Explorer</title>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="css/site.css"/>
		<script src="js/jquery.js" type="text/javascript"></script>
		<script src="js/d3.v3.min.js" type="text/javascript"></script>
		<script src="js/topojson.v1.min.js" type="text/javascript"></script>
		<script src="js/queue.v1.min.js" type="text/javascript"></script>
		<script src="site.js" type="text/javascript"></script>
	</head>
	<body>
		<div class="container dashbord">
			<div class="row">
				<div class="col-md-4">
					<h2>WSS Data</h2>
					<p class="subtitle">Water Supply and Sanitation (JMP WHO/UNICEF)</p>
				</div>
				<div class="col-md-8 spacersm">
					<p>
						For feedback email <a href="mailto:raimbault.bruno@gmail.com">raimbault.bruno@gmail.com</a>
					</p>
					<p>
						Data source: <a href="http://www.wssinfo.org">www.wssinfo.org</a>
					</p>
				</div>
			</div>

			<div class="row">
				<div class="col-md-7">
					<table><tbody><tr><td style="width: 105px"><h4>World Map - </h4></td><td><h4><div id="year">1990</div></h4></td></tr></tbody></table>
					<div id="container"></div>
				</div>
				<div class="col-md-5">
				<table><tbody><tr><td style="width: 500px"><h4>Country details</h4></td></tr></tbody></table>
					<div>
						<table style="width:250px">
						<tbody><tr><th id="td_selected_name" colspan="2">Select a country or year</th></tr>
						</tbody></table>
					</div>	
					<div id="line_total"></div>
					<div id="info">
						<h1 id="name"></h1>
						<div style="margin:10px -10px 0 0;font-size:12px;line-height:120%;text-align:left">
						  <table><tbody><tr><td style="width: 500px"><h4>Animation options</h4></td></tr></tbody></table>
						  <button id="pause_button" class="paused" style="width:125px;margin-bottom:0">Play</button><button id="replay" style="width:125px">Replay</button>
						  <form onsubmit="return false">
						  
						  <br>
						  <p>Choose time series to display on the map</p>
						  
						  <select style="width:125px" id="select_series1">
						  		<option value="Wat" selected="selected">Access to water</option>
						  		<option value="San">Access to sanitation</option>
						  </select><select style="width:125px" id="select_series2">
						  		<option value="N" selected="selected">on average </option>
						  		<option value="R">in rural areas</option>
						  		<option value="U">in urban areas</option>
						  </select>
						  <br>		
						  
						  <p><br>Choose animation speed<br>(milliseconds per year, default=2000)</p>
						  <input style="width:250px" id="anim_speed" min="1" max="20000" value="2000" autocomplete="off" type="number">
						  </form>
						 </div>	
					</div>
				</div>

			</div>
		</div>
		<script>
			// Redraw on window resize
			d3.select(window).on("resize", throttle);
				
			var serie1 = "Wat",
				serie2 = "N",
				speed = 2000,
		    	first_year = 1990,
		    	end_year = 2012,
		    	active = d3.select(null),
		    	active_id = null;
		    
			WSS_Data_firstdraw();
			
			$("#select_series1").change(function() 
				{
				serie1 = $("#select_series1 option:selected").attr("value");
				serie2 = $("#select_series2 option:selected").attr("value");
				updateLineChart(active_id,false);
				WSS_Data_update();
				});
			
			$("#select_series2").change(function() 
				{
				serie1 = $("#select_series1 option:selected").attr("value");
				serie2 = $("#select_series2 option:selected").attr("value");
				updateLineChart(active_id,false);
				WSS_Data_update();
				});
				
			var playTimer;
			var toggle = 1;
			
			$("#pause_button").click(function(){
				toggle = 1 - toggle;
				$("#pause_button").text(function(){return toggle? 'Resume' : 'Pause';});
				if($("#pause_button").hasClass("paused")){
					playTimer = setInterval(function(){autoAdvance();}, speed);
					$("#pause_button").removeClass("paused");
					$("#pause_button").addClass("playing");
				} else {
				clearInterval(playTimer);
					$("#pause_button").removeClass("playing");
					$("#pause_button").addClass("paused");
				}
			});
			
			$("#replay").click(function() {
				$("#pause_button").trigger("click");
				document.getElementById('year').innerHTML=first_year-1;
				$("#pause_button").trigger("click");
			});
			
			
			// initiate autoplay on page load
			/*$( document ).ready(function(){
				$("#pause_button").trigger("click");
			});*/
				
			$("#anim_speed").change(function()
				{
				$("#pause_button").trigger("click");
				speed = $(this).val();
				$("#pause_button").trigger("click");
				});
		</script>
	</body>
</html>
